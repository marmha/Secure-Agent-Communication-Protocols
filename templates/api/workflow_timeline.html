<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Workflow Timeline</title>
    <meta http-equiv="refresh" content="5">  <!-- auto refresh every 5s -->

    <style>
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: #020617;
            color: #e5e7eb;
            margin: 0;
            padding: 0;
        }
        header {
            padding: 16px 24px;
            background: #0f172a;
            border-bottom: 1px solid #1f2937;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        h1 {
            font-size: 1.4rem;
            margin: 0;
        }
        .subtitle {
            font-size: 0.85rem;
            color: #9ca3af;
        }
        .container {
            max-width: 960px;
            margin: 16px auto;
            padding: 0 16px 24px;
        }
        .event {
            position: relative;
            padding: 10px 14px 10px 24px;
            margin-bottom: 8px;
            background: #020617;
            border-left: 3px solid #38bdf8;
            border-radius: 4px;
        }
        .event::before {
            content: "";
            position: absolute;
            left: -7px;
            top: 12px;
            width: 10px;
            height: 10px;
            border-radius: 999px;
            background: #38bdf8;
        }
        .meta {
            font-size: 0.8rem;
            color: #9ca3af;
            margin-bottom: 4px;
        }
        .endpoint {
            font-weight: 600;
            color: #38bdf8;
        }
        .agent {
            font-weight: 600;
            color: #a5b4fc;
        }
        pre {
            margin: 4px 0;
            font-size: 0.75rem;
            background: #020617;
            padding: 6px;
            border-radius: 4px;
            border: 1px solid #111827;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .section-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            color: #9ca3af;
            margin-top: 4px;
        }
        .empty {
            text-align: center;
            margin-top: 40px;
            color: #6b7280;
        }
    </style>
</head>
<body>
    <header>
        <div>
            <h1>Workflow Timeline</h1>
            <div class="subtitle">
                Last {{ logs|length }} events &middot; Auto-refresh every 5 seconds
            </div>
        </div>
        <div class="subtitle">
            <a href="/admin/" style="color:#38bdf8; text-decoration:none;">Admin</a>
        </div>
    </header>

    <div class="container">
        {% if logs %}
            {% for log in logs %}
                <div class="event">
                    <div class="meta">
                        {{ log.timestamp }} —
                        <span class="agent">
                            {% if log.agent %}{{ log.agent.name }}{% else %}system{% endif %}
                        </span>
                        ·
                        <span class="endpoint">{{ log.endpoint }}</span>
                    </div>

                    {% if log.request_data %}
                        <div class="section-label">Request</div>
                        <pre>{{ log.request_data|safe }}</pre>
                    {% endif %}

                    {% if log.response_data %}
                        <div class="section-label">Response</div>
                        <pre>{{ log.response_data|safe }}</pre>
                    {% endif %}
                </div>
            {% endfor %}
        {% else %}
            <div class="empty">
                No audit events yet. Trigger demo_order.py to see the workflow.
            </div>
        {% endif %}
    </div>
</body>
</html>
